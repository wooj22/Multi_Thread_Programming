<svg viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
  <!-- 제목 -->
  <text x="450" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">동적 메모리 할당이 컨텍스트 스위칭을 유발하는 경로</text>
  
  <!-- 메인 플로우 -->
  <rect x="350" y="60" width="200" height="50" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5"/>
  <text x="450" y="90" text-anchor="middle" font-size="14" font-weight="bold" fill="white">동적 메모리 할당 요청</text>
  
  <!-- 원인 1: 힙 락 경합 -->
  <rect x="50" y="150" width="180" height="80" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5"/>
  <text x="140" y="175" text-anchor="middle" font-size="13" font-weight="bold" fill="white">힙 락 경합</text>
  <text x="60" y="195" font-size="10" fill="white">• malloc/free 동기화</text>
  <text x="60" y="210" font-size="10" fill="white">• 스레드 블로킹</text>
  <text x="60" y="225" font-size="10" fill="white">• 락 대기 시간</text>
  
  <!-- 원인 2: 페이지 폴트 -->
  <rect x="250" y="150" width="180" height="80" fill="#f39c12" stroke="#e67e22" stroke-width="2" rx="5"/>
  <text x="340" y="175" text-anchor="middle" font-size="13" font-weight="bold" fill="white">페이지 폴트</text>
  <text x="260" y="195" font-size="10" fill="white">• 새 페이지 할당</text>
  <text x="260" y="210" font-size="10" fill="white">• 커널 모드 전환</text>
  <text x="260" y="225" font-size="10" fill="white">• 물리 메모리 매핑</text>
  
  <!-- 원인 3: 가비지 컬렉션 -->
  <rect x="450" y="150" width="180" height="80" fill="#27ae60" stroke="#229954" stroke-width="2" rx="5"/>
  <text x="540" y="175" text-anchor="middle" font-size="13" font-weight="bold" fill="white">가비지 컬렉션</text>
  <text x="460" y="195" font-size="10" fill="white">• GC 트리거</text>
  <text x="460" y="210" font-size="10" fill="white">• 모든 스레드 일시정지</text>
  <text x="460" y="225" font-size="10" fill="white">• Stop-the-world</text>
  
  <!-- 원인 4: 메모리 부족 -->
  <rect x="650" y="150" width="180" height="80" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5"/>
  <text x="740" y="175" text-anchor="middle" font-size="13" font-weight="bold" fill="white">메모리 부족</text>
  <text x="660" y="195" font-size="10" fill="white">• 스와핑 발생</text>
  <text x="660" y="210" font-size="10" fill="white">• 디스크 I/O 대기</text>
  <text x="660" y="225" font-size="10" fill="white">• 페이지 교체</text>
  
  <!-- 화살표들 -->
  <path d="M 400 110 L 140 150" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 430 110 L 340 150" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 470 110 L 540 150" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 500 110 L 740 150" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- 상세 설명 섹션 -->
  <text x="450" y="280" text-anchor="middle" font-size="16" font-weight="bold" fill="#333">각 원인별 상세 메커니즘</text>
  
  <!-- 힙 락 상세 -->
  <rect x="50" y="300" width="400" height="120" fill="#ffebee" stroke="#e74c3c" stroke-width="1" rx="3"/>
  <text x="250" y="320" text-anchor="middle" font-size="14" font-weight="bold" fill="#c0392b">1. 힙 락 경합으로 인한 블로킹</text>
  
  <text x="60" y="340" font-size="11" fill="#666">스레드 A: malloc(1024) 호출 → 힙 락 획득</text>
  <text x="60" y="355" font-size="11" fill="#666">스레드 B: malloc(2048) 호출 → 힙 락 대기 (블로킹)</text>
  <text x="60" y="370" font-size="11" fill="#666">스레드 C: free(ptr) 호출 → 힙 락 대기 (블로킹)</text>
  <text x="60" y="385" font-size="11" fill="#666">→ 대기 중인 스레드들이 컨텍스트 스위칭됨</text>
  <text x="60" y="405" font-size="11" font-weight="bold" fill="#e74c3c">결과: 메모리 할당이 동기화 병목점이 됨</text>
  
  <!-- 페이지 폴트 상세 -->
  <rect x="470" y="300" width="400" height="120" fill="#fff3e0" stroke="#f39c12" stroke-width="1" rx="3"/>
  <text x="670" y="320" text-anchor="middle" font-size="14" font-weight="bold" fill="#e67e22">2. 페이지 폴트로 인한 커널 호출</text>
  
  <text x="480" y="340" font-size="11" fill="#666">대용량 메모리 할당 시 새 페이지 필요</text>
  <text x="480" y="355" font-size="11" fill="#666">→ 페이지 폴트 발생 → 커널 모드 전환</text>
  <text x="480" y="370" font-size="11" fill="#666">→ 물리 메모리 할당 및 가상 메모리 매핑</text>
  <text x="480" y="385" font-size="11" fill="#666">→ 커널 작업 완료까지 스레드 블로킹</text>
  <text x="480" y="405" font-size="11" font-weight="bold" fill="#f39c12">결과: 수십 마이크로초~밀리초 지연</text>
  
  <!-- GC 상세 -->
  <rect x="50" y="440" width="400" height="120" fill="#e8f5e8" stroke="#27ae60" stroke-width="1" rx="3"/>
  <text x="250" y="460" text-anchor="middle" font-size="14" font-weight="bold" fill="#229954">3. 가비지 컬렉션 트리거</text>
  
  <text x="60" y="480" font-size="11" fill="#666">힙 메모리 사용량이 임계치 초과</text>
  <text x="60" y="495" font-size="11" fill="#666">→ GC 트리거 (C#, Java, Go의 경우)</text>
  <text x="60" y="510" font-size="11" fill="#666">→ 모든 애플리케이션 스레드 일시 정지</text>
  <text x="60" y="525" font-size="11" fill="#666">→ GC 스레드가 메모리 정리 작업 수행</text>
  <text x="60" y="545" font-size="11" font-weight="bold" fill="#27ae60">결과: Stop-the-world로 인한 강제 컨텍스트 스위칭</text>
  
  <!-- 스와핑 상세 -->
  <rect x="470" y="440" width="400" height="120" fill="#f3e5f5" stroke="#9b59b6" stroke-width="1" rx="3"/>
  <text x="670" y="460" text-anchor="middle" font-size="14" font-weight="bold" fill="#8e44ad">4. 메모리 부족으로 인한 스와핑</text>
  
  <text x="480" y="480" font-size="11" fill="#666">물리 메모리 부족 → 페이지 스와핑 필요</text>
  <text x="480" y="495" font-size="11" fill="#666">→ 디스크로 페이지 이동 (매우 느림)</text>
  <text x="480" y="510" font-size="11" fill="#666">→ 새 페이지 할당을 위해 I/O 대기</text>
  <text x="480" y="525" font-size="11" fill="#666">→ I/O 완료까지 스레드 블로킹</text>
  <text x="480" y="545" font-size="11" font-weight="bold" fill="#9b59b6">결과: 밀리초~초 단위의 긴 지연</text>
  
  <!-- 컨텍스트 스위칭 결과 -->
  <rect x="300" y="580" width="300" height="60" fill="#34495e" stroke="#2c3e50" stroke-width="2" rx="5"/>
  <text x="450" y="605" text-anchor="middle" font-size="14" font-weight="bold" fill="white">최종 결과</text>
  <text x="450" y="625" text-anchor="middle" font-size="12" fill="white">블로킹된 스레드 → 다른 스레드로 컨텍스트 스위칭</text>
  
  <!-- 연결 화살표들 -->
  <path d="M 250 420 L 420 580" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="3,3"/>
  <path d="M 670 420 L 480 580" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="3,3"/>
  <path d="M 250 560 L 420 590" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="3,3"/>
  <path d="M 670 560 L 480 590" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="3,3"/>
  
  <!-- 화살표 정의 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
</svg>