# Win32 ìŠ¤ë ˆë“œ í”„ë¡œê·¸ë˜ë° í•µì‹¬ ì •ë¦¬

## ğŸ“Œ 1. ê¸°ë³¸ ê°œë… (2ì£¼ì°¨)

### ì»¤ë„(Kernel)ì˜ ì—­í• 
- **ì •ì˜**: ìš´ì˜ì²´ì œì˜ í•µì‹¬ êµ¬ì„±ìš”ì†Œë¡œ í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ì˜ ì¤‘ê°œì
- **í•µì‹¬ ê¸°ëŠ¥**: 
  - í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ ê´€ë¦¬
  - ë©”ëª¨ë¦¬ ê´€ë¦¬ (ê°€ìƒ ë©”ëª¨ë¦¬, í˜ì´ì§•)
  - íŒŒì¼ ì‹œìŠ¤í…œ ê´€ë¦¬
  - ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬

### ìœ ì € ëª¨ë“œ vs ì»¤ë„ ëª¨ë“œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì• í”Œë¦¬ì¼€ì´ì…˜ (ìœ ì € ëª¨ë“œ)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† ëª¨ë“œ ì „í™˜ ê²½ê³„
â”‚   ìš´ì˜ì²´ì œ ì»¤ë„ (ì»¤ë„ ëª¨ë“œ) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      í•˜ë“œì›¨ì–´            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ëª¨ë“œ ì „í™˜ì´ ë°œìƒí•˜ëŠ” ê²½ìš°**:
- ì‹œìŠ¤í…œ ì½œ í˜¸ì¶œ
- I/O ì‘ì—…
- ë™ê¸°í™” ê°ì²´ ëŒ€ê¸° (ë®¤í…ìŠ¤ ê²½í•© ì‹œ)

### í”„ë¡œì„¸ìŠ¤ vs ìŠ¤ë ˆë“œ

| êµ¬ë¶„ | í”„ë¡œì„¸ìŠ¤ | ìŠ¤ë ˆë“œ |
|------|---------|--------|
| ë©”ëª¨ë¦¬ | ë…ë¦½ì  ê°€ìƒ ë©”ëª¨ë¦¬ | í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ê³µìœ  |
| ìƒì„± ë¹„ìš© | ë†’ìŒ | ë‚®ìŒ |
| í†µì‹  | IPC í•„ìš” | ì§ì ‘ ê³µìœ  ê°€ëŠ¥ |
| ì•ˆì •ì„± | ë†’ìŒ (ê²©ë¦¬) | ë‚®ìŒ (ê³µìœ ë¡œ ì¸í•œ ìœ„í—˜) |

## ğŸ“Œ 2. ìŠ¤ë ˆë“œ ìƒì„±ê³¼ ê´€ë¦¬ (3ì£¼ì°¨)

### CreateThread vs _beginthreadex

```cpp
// CreateThread (Win32 API)
HANDLE CreateThread(
    LPSECURITY_ATTRIBUTES lpThreadAttributes,
    SIZE_T dwStackSize,
    LPTHREAD_START_ROUTINE lpStartAddress,
    LPVOID lpParameter,
    DWORD dwCreationFlags,
    LPDWORD lpThreadId
);

// _beginthreadex (C ëŸ°íƒ€ì„ ê¶Œì¥)
uintptr_t _beginthreadex(
    void *security,
    unsigned stack_size,
    unsigned (__stdcall *start_address)(void *),
    void *arglist,
    unsigned initflag,
    unsigned *thrdaddr
);
```

**âš ï¸ ì¤‘ìš”**: C++ í”„ë¡œê·¸ë¨ì—ì„œëŠ” ë°˜ë“œì‹œ `_beginthreadex` ì‚¬ìš©
- CreateThreadëŠ” C ëŸ°íƒ€ì„ ì´ˆê¸°í™” ëˆ„ë½
- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜, ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥

### ìŠ¤ë ˆë“œ ìƒëª…ì£¼ê¸°

```
[ìƒì„±] â†’ [ì‹¤í–‰ê°€ëŠ¥] â†’ [ì‹¤í–‰] â†’ [ëŒ€ê¸°] â†’ [ì¢…ë£Œ]
         â†‘______________|
```

**ìƒíƒœ ì „í™˜ ì¡°ê±´**:
- **ìƒì„± â†’ ì‹¤í–‰ê°€ëŠ¥**: ìŠ¤ë ˆë“œ ì‹œì‘
- **ì‹¤í–‰ê°€ëŠ¥ â†’ ì‹¤í–‰**: ìŠ¤ì¼€ì¤„ëŸ¬ê°€ CPU í• ë‹¹
- **ì‹¤í–‰ â†’ ëŒ€ê¸°**: I/O ì‘ì—…, ë™ê¸°í™” ê°ì²´ ëŒ€ê¸°
- **ì‹¤í–‰ â†’ ì‹¤í–‰ê°€ëŠ¥**: ì‹œê°„ í• ë‹¹ëŸ‰ ì†Œì§„, ì„ ì 

## ğŸ“Œ 3. ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ (2ì£¼ì°¨)

### ë°œìƒ ì›ì¸
1. **íƒ€ì´ë¨¸ ì¸í„°ëŸ½íŠ¸**: ì‹œê°„ í• ë‹¹ëŸ‰(~20ms) ì†Œì§„
2. **I/O ëŒ€ê¸°**: íŒŒì¼/ë„¤íŠ¸ì›Œí¬ ì‘ì—…
3. **ìš°ì„ ìˆœìœ„ ë³€í™”**: ë” ë†’ì€ ìš°ì„ ìˆœìœ„ ìŠ¤ë ˆë“œ ë“±ì¥
4. **ëª…ì‹œì  ì–‘ë³´**: `Thread.Yield()` í˜¸ì¶œ

### ì„±ëŠ¥ ì˜í–¥
```
ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ë¹„ìš© = ì»¤ë„ ëª¨ë“œ ì „í™˜ + ë ˆì§€ìŠ¤í„° ì €ì¥/ë³µì› + ìºì‹œ ë¬´íš¨í™”
                    â‰ˆ 1~10 ë§ˆì´í¬ë¡œì´ˆ
```

**ê²Œì„ í´ë¼ì´ì–¸íŠ¸ ì˜í–¥**:
- í”„ë ˆì„ ë“œë¡­ (60fps â†’ 30fps)
- ì…ë ¥ ì§€ì—°
- ì˜¤ë””ì˜¤ ëŠê¹€
- UI ì‘ë‹µì„± ì €í•˜

## ğŸ“Œ 4. ë™ê¸°í™” ê¸°ì´ˆ (4ì£¼ì°¨)

### Race Condition ë¬¸ì œ

```cpp
// âŒ ìœ„í—˜í•œ ì½”ë“œ
int counter = 0;
void Increment() {
    counter++; // ì‹¤ì œë¡œëŠ” 3ë‹¨ê³„: ì½ê¸°-ì¦ê°€-ì“°ê¸°
}

// âœ… ì•ˆì „í•œ ì½”ë“œ
CRITICAL_SECTION cs;
void SafeIncrement() {
    EnterCriticalSection(&cs);
    counter++;
    LeaveCriticalSection(&cs);
}
```

### ë™ê¸°í™” ê°ì²´ ë¹„êµ

| ê°ì²´ | ì†ë„ | ë²”ìœ„ | íŠ¹ì§• | ìš©ë„ |
|------|------|------|------|------|
| Critical Section | ë¹ ë¦„ | í”„ë¡œì„¸ìŠ¤ ë‚´ | ì¬ì§„ì… ê°€ëŠ¥ | ê°„ë‹¨í•œ ìƒí˜¸ë°°ì œ |
| Mutex | ë³´í†µ | í”„ë¡œì„¸ìŠ¤ ê°„ | ì†Œìœ ê¶Œ ê°œë… | í”„ë¡œì„¸ìŠ¤ ê°„ ë™ê¸°í™” |
| Semaphore | ë³´í†µ | í”„ë¡œì„¸ìŠ¤ ê°„ | ì¹´ìš´í„° ê¸°ë°˜ | ìì› í’€ ê´€ë¦¬ |
| Event | ë³´í†µ | í”„ë¡œì„¸ìŠ¤ ê°„ | ìƒíƒœ ì•Œë¦¼ | ì¡°ê±´ ëŒ€ê¸°/ì‹ í˜¸ |

### Event ê°ì²´ (Manual/Auto Reset)

```cpp
// Auto-Reset: í•œ ìŠ¤ë ˆë“œë§Œ ê¹¨ì›€
HANDLE hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);

// Manual-Reset: ëª¨ë“  ìŠ¤ë ˆë“œ ê¹¨ì›€
HANDLE hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```cpp
// ìƒì‚°ì
g_data = 42;
SetEvent(g_hEvent);  // ì†Œë¹„ìì—ê²Œ ì‹ í˜¸

// ì†Œë¹„ì
WaitForSingleObject(g_hEvent, INFINITE);
int value = g_data;  // ì•ˆì „í•˜ê²Œ ì½ê¸°
```

## ğŸ“Œ 5. Interlocked í•¨ìˆ˜ (5ì£¼ì°¨)

### ì›ìì  ì—°ì‚°ì˜ ì¤‘ìš”ì„±

```cpp
// âŒ ë¹„ì›ìì  - Race Condition ë°œìƒ
LONG g_counter = 0;
g_counter++;  // ìœ„í—˜!

// âœ… ì›ìì  - ì•ˆì „
LONG g_counter = 0;
InterlockedIncrement(&g_counter);  // ì•ˆì „!
```

### ì£¼ìš” Interlocked í•¨ìˆ˜

```cpp
// ì¦ê°
InterlockedIncrement(&value);
InterlockedDecrement(&value);

// êµí™˜
InterlockedExchange(&target, newValue);

// CAS (Compare And Swap)
InterlockedCompareExchange(&dest, exchange, comparand);

// ë§ì…ˆ
InterlockedAdd(&value, amount);

// í¬ì¸í„° êµí™˜
InterlockedExchangePointer(&ptr, newPtr);

// ë©”ëª¨ë¦¬ ì¥ë²½
MemoryBarrier();
```

### Lock-Free ìŠ¤í•€ë½ êµ¬í˜„

```cpp
class SpinLock {
    volatile LONG locked;
public:
    SpinLock() : locked(0) {}
    
    void Lock() {
        while (InterlockedCompareExchange(&locked, 1, 0) != 0) {
            YieldProcessor();  // CPU ì–‘ë³´
        }
    }
    
    void Unlock() {
        InterlockedExchange(&locked, 0);
    }
};
```

## ğŸ“Œ 6. íë¦„ ì œì–´ íŒ¨í„´ (5ì£¼ì°¨)

### ìƒì‚°ì-ì†Œë¹„ì íŒ¨í„´

```cpp
CRITICAL_SECTION cs;
HANDLE hEvent;
std::queue<int> buffer;

// ìƒì‚°ì
void Produce(int value) {
    EnterCriticalSection(&cs);
    buffer.push(value);
    LeaveCriticalSection(&cs);
    SetEvent(hEvent);  // ì†Œë¹„ì ê¹¨ìš°ê¸°
}

// ì†Œë¹„ì
int Consume() {
    WaitForSingleObject(hEvent, INFINITE);
    EnterCriticalSection(&cs);
    int value = buffer.front();
    buffer.pop();
    LeaveCriticalSection(&cs);
    return value;
}
```

### ë¦¬ë”-ë¼ì´í„° íŒ¨í„´ (Reader-Writer Lock)

```cpp
// ì—¬ëŸ¬ ë¦¬ë” ë™ì‹œ ì ‘ê·¼, ë‹¨ì¼ ë¼ì´í„°
SRWLOCK lock;
InitializeSRWLock(&lock);

// ì½ê¸°
AcquireSRWLockShared(&lock);
// ... ì½ê¸° ì‘ì—… ...
ReleaseSRWLockShared(&lock);

// ì“°ê¸°
AcquireSRWLockExclusive(&lock);
// ... ì“°ê¸° ì‘ì—… ...
ReleaseSRWLockExclusive(&lock);
```

## ğŸ“Œ 7. ê³ ê¸‰ ë™ê¸°í™” (6ì£¼ì°¨)

### Condition Variable

```cpp
CRITICAL_SECTION cs;
CONDITION_VARIABLE cv;
bool ready = false;

// ëŒ€ê¸°
EnterCriticalSection(&cs);
while (!ready) {
    SleepConditionVariableCS(&cv, &cs, INFINITE);
}
LeaveCriticalSection(&cs);

// ì‹ í˜¸
EnterCriticalSection(&cs);
ready = true;
WakeConditionVariable(&cv);
LeaveCriticalSection(&cs);
```

**í•µì‹¬ ê·œì¹™**:
- í•­ìƒ `while` ë£¨í”„ë¡œ ì¡°ê±´ ì¬ê²€ì‚¬
- ìƒíƒœ ë³€ê²½ í›„ ë½ ì•ˆì—ì„œ ì‹ í˜¸
- `WakeConditionVariable` (1ê°œ) vs `WakeAllConditionVariable` (ì „ì²´)

### ìŠ¤ë ˆë“œ í’€ API

```cpp
// ê¸°ë³¸ ì‘ì—…
PTP_WORK work = CreateThreadpoolWork(callback, data, &env);
SubmitThreadpoolWork(work);
WaitForThreadpoolWorkCallbacks(work, FALSE);
CloseThreadpoolWork(work);

// íƒ€ì´ë¨¸
PTP_TIMER timer = CreateThreadpoolTimer(callback, data, &env);
SetThreadpoolTimer(timer, &dueTime, period, 0);

// ëŒ€ê¸°
PTP_WAIT wait = CreateThreadpoolWait(callback, data, &env);
SetThreadpoolWait(wait, hEvent, NULL);

// ë¹„ë™ê¸° I/O
PTP_IO io = CreateThreadpoolIo(hFile, callback, data, &env);
StartThreadpoolIo(io);
ReadFile(hFile, buffer, size, NULL, &overlapped);
```

## ğŸ“Œ 8. ì‹¤ë¬´ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. ë™ê¸°í™” ê°ì²´ ì„ íƒ ê°€ì´ë“œ

```
í”„ë¡œì„¸ìŠ¤ ë‚´ ê°„ë‹¨í•œ ë³´í˜¸ â†’ Critical Section
í”„ë¡œì„¸ìŠ¤ ê°„ ë™ê¸°í™” â†’ Mutex
ìì› í’€ ì œí•œ â†’ Semaphore
ì¡°ê±´ ëŒ€ê¸° â†’ Condition Variable
ì½ê¸° ë‹¤ìˆ˜, ì“°ê¸° ì†Œìˆ˜ â†’ SRW Lock
```

### 2. ë°ë“œë½ ë°©ì§€

```cpp
// âŒ ë‚˜ìœ ì˜ˆ - ë°ë“œë½ ê°€ëŠ¥
void ThreadA() {
    EnterCriticalSection(&cs1);
    EnterCriticalSection(&cs2);  // ìœ„í—˜!
    // ...
    LeaveCriticalSection(&cs2);
    LeaveCriticalSection(&cs1);
}

void ThreadB() {
    EnterCriticalSection(&cs2);
    EnterCriticalSection(&cs1);  // ë°ë“œë½!
}

// âœ… ì¢‹ì€ ì˜ˆ - í•­ìƒ ê°™ì€ ìˆœì„œ
void Safe() {
    EnterCriticalSection(&cs1);  // í•­ìƒ 1 ë¨¼ì €
    EnterCriticalSection(&cs2);  // í•­ìƒ 2 ë‚˜ì¤‘
    // ...
    LeaveCriticalSection(&cs2);
    LeaveCriticalSection(&cs1);
}
```

### 3. ì„±ëŠ¥ ìµœì í™”

```cpp
// ìŠ¤í•€ ì¹´ìš´íŠ¸ ì„¤ì •ìœ¼ë¡œ ì»¤ë„ ì „í™˜ ì¤„ì´ê¸°
InitializeCriticalSectionAndSpinCount(&cs, 4000);

// Try í•¨ìˆ˜ë¡œ ë¸”ë¡œí‚¹ íšŒí”¼
if (TryEnterCriticalSection(&cs)) {
    // ì‘ì—… ìˆ˜í–‰
    LeaveCriticalSection(&cs);
} else {
    // ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰
}
```

### 4. ë©”ëª¨ë¦¬ ê°€ì‹œì„±

```cpp
// volatileì€ ë™ê¸°í™”ê°€ ì•„ë‹˜!
volatile int flag = 0;  // âŒ ë©€í‹°ìŠ¤ë ˆë“œ ì•ˆì „í•˜ì§€ ì•ŠìŒ

// Interlockedë‚˜ ë½ ì‚¬ìš©
LONG flag = 0;
InterlockedExchange(&flag, 1);  // âœ… ì•ˆì „
```

## ğŸ“Œ 9. ë””ë²„ê¹… íŒ

### ë™ê¸°í™” ë¬¸ì œ íƒì§€

1. **ThreadSanitizer** ì‚¬ìš© (Visual Studio)
2. **Application Verifier** í™œìš©
3. **Performance Monitor**ë¡œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ëª¨ë‹ˆí„°ë§
4. **WinDbg**ë¡œ ë°ë“œë½ ë¶„ì„

```
// WinDbg ëª…ë ¹ì–´
!locks          // ëª¨ë“  ë½ ìƒíƒœ í™•ì¸
!cs -l          // Critical Section ìƒíƒœ
!runaway        // CPU ì‹œê°„ ë¶„ì„
```

## ğŸ“Œ 10. ìš”ì•½ ì²´í¬ë¦¬ìŠ¤íŠ¸

âœ… **ê¸°ë³¸ ê°œë…**
- [ ] í”„ë¡œì„¸ìŠ¤ì™€ ìŠ¤ë ˆë“œ ì°¨ì´ ì´í•´
- [ ] ìœ ì €/ì»¤ë„ ëª¨ë“œ ì „í™˜ ì´í•´
- [ ] ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ì˜í–¥ íŒŒì•…

âœ… **ìŠ¤ë ˆë“œ ê´€ë¦¬**
- [ ] `_beginthreadex` ì‚¬ìš©
- [ ] ìŠ¤ë ˆë“œ ìƒëª…ì£¼ê¸° ê´€ë¦¬
- [ ] ì•ˆì „í•œ ì¢…ë£Œ íŒ¨í„´ ì ìš©

âœ… **ë™ê¸°í™”**
- [ ] Race Condition ì´í•´
- [ ] ì ì ˆí•œ ë™ê¸°í™” ê°ì²´ ì„ íƒ
- [ ] ë°ë“œë½ ë°©ì§€ íŒ¨í„´ ì ìš©

âœ… **ì„±ëŠ¥**
- [ ] Interlocked í•¨ìˆ˜ í™œìš©
- [ ] Lock-Free ìë£Œêµ¬ì¡° ì´í•´
- [ ] ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ìµœì†Œí™”

âœ… **ê³ ê¸‰ ê¸°ë²•**
- [ ] Condition Variable ì‚¬ìš©
- [ ] ìŠ¤ë ˆë“œ í’€ í™œìš©
- [ ] ë¹„ë™ê¸° I/O ì´í•´

---

ì´ ì •ë¦¬ê°€ Win32 ë©€í‹°ìŠ¤ë ˆë“œ í”„ë¡œê·¸ë˜ë° í•™ìŠµì— ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤! ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.